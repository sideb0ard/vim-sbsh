#!/bin/bash
set -euf -o pipefail

VIM=${VIM:-"vim"}
TMUX=${TMUX:-"tmux"}

FILE=${FILE:-"$(date +%F).sbsh"}
SESSION=${SESSION:-"sbsh"}

args=${@:-$FILE}

# Check if tmux session "sbsh" is running and attach,
# else create new session, split windows and run processes
$TMUX -2 attach-session -t $SESSION || $TMUX -2 \
  new-session -s $SESSION   \; \
  split-window -h -t $SESSION   \; \
  send-keys -t 0 "./sbsh" C-m   \; \
  send-keys -t 1 "$VIM $args" C-m   \; \
  select-pane -t 1
